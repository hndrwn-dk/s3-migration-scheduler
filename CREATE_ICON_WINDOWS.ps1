# Create Icon for Windows Build
Write-Host "Creating basic icon file..." -ForegroundColor Green

# Navigate to electron-app directory
if (!(Test-Path "package.json")) {
    Write-Host "Please run this from the electron-app directory!" -ForegroundColor Red
    exit 1
}

# Create build directory
if (!(Test-Path "build")) {
    New-Item -ItemType Directory -Path "build" | Out-Null
    Write-Host "Created build directory" -ForegroundColor Green
}

# Method 1: Try to download a simple icon
try {
    Write-Host "Downloading icon..." -ForegroundColor Yellow
    Invoke-WebRequest -Uri "https://raw.githubusercontent.com/microsoft/vscode/main/resources/win32/code.ico" -OutFile "build\icon.ico" -ErrorAction Stop
    Write-Host "✅ Downloaded icon successfully!" -ForegroundColor Green
} catch {
    Write-Host "Download failed, creating placeholder..." -ForegroundColor Yellow
    
    # Method 2: Create a basic 1x1 pixel ICO file as placeholder
    $iconBytes = @(
        0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x01, 0x01, 0x00, 0x00, 0x01, 0x00, 0x08, 0x00, 0x68, 0x00,
        0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x02, 0x00,
        0x00, 0x00, 0x01, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x80, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00,
        0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x80, 0x80, 0x80, 0x00,
        0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xFF, 0x00, 0x00, 0x00,
        0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00
    )
    
    [System.IO.File]::WriteAllBytes("build\icon.ico", $iconBytes)
    Write-Host "✅ Created placeholder icon!" -ForegroundColor Green
}

# Verify the file was created
if (Test-Path "build\icon.ico") {
    $size = (Get-Item "build\icon.ico").Length
    Write-Host "✅ Icon file created: build\icon.ico ($size bytes)" -ForegroundColor Green
    Write-Host ""
    Write-Host "Now run:" -ForegroundColor Cyan
    Write-Host "npx electron-builder --win --config.icon=build/icon.ico" -ForegroundColor White
} else {
    Write-Host "❌ Failed to create icon file" -ForegroundColor Red
}